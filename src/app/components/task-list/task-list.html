<ng-container *ngIf="(errorMessages$ | async) as errors">
  <div *ngIf="errors['title']" class="error-message">
    {{ errors['title'] }}
  </div>

  <div *ngIf="errors['description']" class="error-message">
    {{ errors['description'] }}
  </div>

  <div *ngIf="errors['status']" class="error-message">
    {{ errors['status'] }}
  </div>

  <div *ngIf="errors['dueDate']" class="error-message">
    {{ errors['dueDate'] }}
  </div>
</ng-container>

<!-- Create Task Form -->
<form (ngSubmit)="createTask(createForm)" #createForm="ngForm" class="table">
  <div class="table-row">
    <div class="table-data">
      <input
        type="text"
        name="title"
        placeholder="Title"
        [(ngModel)]="newTask.title"
        required
        maxlength="255"
        #title="ngModel"
      />
      <div *ngIf="title.invalid && (title.dirty || title.touched)">
        <small *ngIf="title.errors?.['required']">Required!</small>
        <small *ngIf="title.errors?.['maxlength']">Max 255 chars!</small>
      </div>
    </div>

    <div class="table-data">
      <input
        type="text"
        name="description"
        placeholder="Description"
        [(ngModel)]="newTask.description"
        maxlength="255"
        #description="ngModel"
      />
      <div *ngIf="description.invalid && (description.dirty || description.touched)">
        <small *ngIf="description.errors?.['maxlength']">Max 255 chars!</small>
      </div>
    </div>

    <div class="table-data">
      <select name="status" [(ngModel)]="newTask.status" required #status="ngModel">
        <option value="">--</option>
        <option value="pending">Pending</option>
        <option value="active">Active</option>
        <option value="done">Done</option>
      </select>
      <div *ngIf="status.invalid && (status.dirty || status.touched)">
        <small *ngIf="status.errors?.['required']">Required!</small>
      </div>
    </div>

    <div class="table-data">
      <input
        type="datetime-local"
        name="dueDate"
        [(ngModel)]="newTask.dueDate"
        required
		[min]="minDueDate"
        #dueDate="ngModel"
      />
      <div *ngIf="dueDate.invalid && (dueDate.dirty || dueDate.touched)">
        <small *ngIf="dueDate.errors?.['required']">Required! </small>
		<small *ngIf="!isFutureDate(newTask.dueDate)">Must be in the future!</small>
      </div>
    </div>

    <div class="table-data">
      <button type="submit" [disabled]="createForm.invalid || !isFutureDate(newTask.dueDate)">Create</button>
    </div>
  </div>
</form>
<br />
<!-- Task List Table -->
<div class="table">
  <div class="table-header">
    <div class="header__item">Title</div>
    <div class="header__item">Description</div>
    <div class="header__item">Status</div>
    <div class="header__item">Due Date</div>
    <div class="header__item">Action</div>
  </div>

  <div class="table-row" *ngFor="let task of tasks$ | async">
    <div class="table-data">{{ task.title }}</div>
    <div class="table-data">{{ task.description }}</div>

    <div class="table-data">
      <ng-container *ngIf="editingTask?.id === task.id; else staticStatus">
        <select
          [ngModel]="editingTask?.status"
          (ngModelChange)="editingTask && (editingTask.status = $event)"
        >
          <option value="pending">Pending</option>
          <option value="active">Active</option>
          <option value="done">Done</option>
        </select>
      </ng-container>
      <ng-template #staticStatus>{{ task.status }}</ng-template>
    </div>

    <div class="table-data">{{ task.dueDate | date: 'yyyy-MM-dd HH:mm' }}</div>

    <div class="table-data">
      <ng-container *ngIf="editingTask?.id === task.id">
        <button (click)="updateTask()">Save</button>
        <button (click)="cancelEdit()">Cancel</button>
      </ng-container>
      <ng-container *ngIf="!editingTask">
        <button (click)="editTask(task)">Edit</button>
        <button (click)="deleteTask(task.id!)">Delete</button>
      </ng-container>
    </div>
  </div>
</div>